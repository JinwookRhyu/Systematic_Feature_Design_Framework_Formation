# Systematic Feature Design for Cycle Life Prediction of Lithium-Ion Batteries During Formation

This repository contains the software for [Systematic Feature Design for Cycle Life Prediction of Lithium-Ion Batteries During Formation] which can be used to design predictive yet interpretable features for cycle life prediction based only on experimental data during the formation step. Processed data can be found at Zenodo at 10.5281/zenodo.14916092.

![framework_v4](https://github.com/user-attachments/assets/af8c1326-84ac-4f3c-b7e3-1031835772b9)

# How to "design" the features?

* "data_formation" folder contains the processed dataset of Q^A(V), t^A(V), Q^B(V), V^B(t), Q^C(V), and V^C(t) that are used as the input data candidates. Raw data, which were generated by Cui et al. (https://doi.org/10.1016/j.joule.2024.07.024), can be found at https://data.matr.io/8/.
* We feed these data to the "regression_formation_nested_CV.R" code in "fused_LASSO" folder to obtain the trajectory of regression coefficients as a function of lambda. This step takes a few hours, so we deposited the output in "results_fusedlasso.zip" at Zenodo. Details on the fused lasso software can be found at Schaeffer et al. (https://doi.org/10.1016/j.compchemeng.2023.108471) and https://rdrr.io/cran/genlasso/man/fusedlasso.html.
* We feed the results in "results_fusedlasso" folder to the "feature_design_nested_CV.m" code for feature design. It is a MATLAB code that demonstrates the overall feature design framework. For the given input data, it overgoes (1) determination of lambda, (2) partitioning based on beta, (3) design of features, (4) merge sections, and (5) feature down-selection. The designed features will be stored in the "Features_designed" folder. "cvx" MATLAB package is needed to run this code, where the installation details can be found at https://cvxr.com/cvx/doc/install.html.

# How to extract "autoML" features using "tsfresh" package?

* We run the "tsfresh_feature_extraction.ipynb" code in the "tsfresh_feature_extraction" folder. This code stores the autoML features in three folders: "Features_tsfresh_autoML", "Features_tsfresh_autoML_labeled", and "Features_tsfresh_autoML_fulllist". The first folder will be used for constructing ML models, whereas the other two are generated to check which autoML features were used. We deposited the zip files for each folder at Zenodo.

# How to construct ML models using "SPA" package?

* We run "run_SPA.ipynb" code in the "SPA" folder. This code constructs ML models using the features stored in "Features_agnostic", "Features_tsfresh_autoML", and "Features_designed" folders. ML models for each approach (agnostic, autoML, and designed) are stored in "SPA_results_agnostic", "SPA_results_autoML", and "SPA_results_designed" folders, respectively. It could take > 1 day for constructing 2448 autoML models using this code, so we have deposited the zip file for SPA_results at Zenodo.
* Details for SPA software can be found at Sun and Braatz (https://doi.org/10.1016/j.compchemeng.2020.107134)
* Details for ALVEN algorithm can be found at Sun and Braatz (https://doi.org/10.1016/j.compchemeng.2020.107103)
* Details for LCEN algorithm can be found at Seber and Braatz (https://doi.org/10.48550/arXiv.2402.17120)

# How can we analyze the ML models constructed by SPA package?

* We run "SPA_results_analysis.ipynb" code in the "SPA" folder. This code extracts the summary results from the ML models stored in "SPA_results_XXX" folders, and saves the output in the "summarized_results" folder.
* We also attached the "prediction_results.xlsx" file for a quick summary.
* "figures.m" is a MATLAB code that generates key figures used in the manuscript.

## Acknowledgement

This work was supported by the Toyota Research Institute through D3BATT: Center for Data-Driven Design of Li-Ion Batteries.
