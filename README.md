# Systematic Feature Design for Cycle Life Prediction of Lithium-Ion Batteries During Formation

This repository contains the software accompanying the paper [Systematic Feature Design for Cycle Life Prediction of Lithium-Ion Batteries During Formation](https://doi.org/10.1016/j.joule.2025.101884) which can be used to design predictive yet interpretable features for cycle life prediction based only on experimental data during the formation step. Processed data can be found at Zenodo at [10.5281/zenodo.14916092](https://doi.org/10.5281/zenodo.14916092).

![framework_v4](https://github.com/user-attachments/assets/af8c1326-84ac-4f3c-b7e3-1031835772b9)

# How to preprocess the formation data?

* Raw data, which were generated by Cui et al. (https://doi.org/10.1016/j.joule.2024.07.024), can be found at https://data.matr.io/8/. Please ensure that you are accessing to the data with 03/03/2025 version (data_03032025.tgz ~15 GB). If you can only access to the data.tgz (~3 GB), please clear cache and re-access to the link. Once you download the raw dataset, please unzip and store the "data_03032025" folder to the directory where "Preprocessing_formation_data.ipynb" is located.
* We run "Preprocessing_formation_data.ipynb" to preprocess the raw formation dataset. It will create the "data_formation" folder and stores the preprocessed dataset of Q^A(V), t^A(V), Q^B(V), V^B(t), Q^C(V), and V^C(t), which are used as the input data candidates.
  
# How to "design" the features?

* We feed the preprocessed dataset in the "data_formation" folder to the "regression_formation_nested_CV.R" code in the "fused_LASSO" folder to obtain the trajectory of regression coefficients as a function of lambda. This step takes a few hours, so we deposited the output in "results_fusedlasso.zip" at Zenodo. Details on the fused lasso software can be found at Schaeffer et al. (https://doi.org/10.1016/j.compchemeng.2023.108471) and https://rdrr.io/cran/genlasso/man/fusedlasso.html.
* We feed the results in "results_fusedlasso" folder to the "feature_design_nested_CV.m" code for feature design. It is a MATLAB code that demonstrates the overall feature design framework. For the given input data, it overgoes (1) determination of lambda, (2) partitioning based on beta, (3) design of features, (4) merge sections, and (5) feature down-selection. The designed features will be stored in the "Features_designed" folder. "cvx" MATLAB package is needed to run this code, where the installation details can be found at https://cvxr.com/cvx/doc/install.html.

# How to extract "autoML" features using "tsfresh" package?

* We run the "tsfresh_feature_extraction.ipynb" code in the "tsfresh_feature_extraction" folder. This code stores the autoML features in three folders: "Features_tsfresh_autoML", "Features_tsfresh_autoML_labeled", and "Features_tsfresh_autoML_fulllist". The first folder will be used for constructing ML models, whereas the other two are generated to check which autoML features were used. We deposited the zip files for each folder at Zenodo.
* Details on the tsfresh package can be found at https://tsfresh.readthedocs.io/en/latest/

# How to construct ML models using "SPA" package?

* We run "run_SPA.ipynb" code in the "SPA" folder. This code constructs ML models using the features stored in "Features_agnostic", "Features_tsfresh_autoML", and "Features_designed" folders. ML models for each approach (agnostic, autoML, and designed) are stored in "SPA_results_agnostic", "SPA_results_autoML", and "SPA_results_designed" folders, respectively. It could take > 1 day for constructing 2448 autoML models using this code, so we have deposited the zip file for SPA_results at Zenodo.
* Details for SPA software can be found at Sun and Braatz (https://doi.org/10.1016/j.compchemeng.2020.107134)
* Details for ALVEN algorithm can be found at Sun and Braatz (https://doi.org/10.1016/j.compchemeng.2020.107103)
* Details for LCEN algorithm can be found at Seber and Braatz (https://doi.org/10.48550/arXiv.2402.17120)

# How can we analyze the ML models constructed by SPA package?

* We run "SPA_results_analysis.ipynb" code in the "SPA" folder. This code extracts the summary results from the ML models stored in "SPA_results_XXX" folders, and saves the output in the "summarized_results" folder.
* We also attached the "prediction_results.xlsx" file for a quick summary.
* "figures.m" is a MATLAB code that generates key figures used in the manuscript.

# How to simulate system using physics-based model? 

* Related code can be found at 10.5281/zenodo.14916092
* The physics based model is run using the MATLAB script ZZ_test_T_variations_v2.m. The editable parameters and the savepath in the 'out' directory can be specified. For the paper's figure regarding the physics based model, a specific parameter set was used which called MATLAB user-defined function Z_FINAL_parameter_specific_run_v2.m. The source code is found in the path 'from_cluster/20240907_parameter_specific'.
* In Script ZZ_test_T_variations_v2.m, the first line of the script defines the savepath. Lines 2-9 indicate the editable parameters. Note that running this simulation, especially at large resistance distributions can take on order of hours to days due to the construction of the battery simulation software.

# How do I plot the electrochemical signatures and distributions visualized in Figure 6? 

* Related code can be found at 10.5281/zenodo.14916092
* The figure 6 results come from a simulation found under the filepath 'from_cluster/20240907_parameter_specific/out/parameter_set_146_45_Tref35_good/results.mat'. Script ZZ_FINAL_plot_distributions_best.m plots the resistance or rate constant distribution from the best identified parameter set, and Script ZZ_FINAL_plot_esignatures.m plots the dQ/dV and d2Q/dV2 features from the best identified parameter set.

## Acknowledgement

This work was supported by the Toyota Research Institute through D3BATT: Center for Data-Driven Design of Li-Ion Batteries.
